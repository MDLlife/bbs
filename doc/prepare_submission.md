# Content Submission Process

The content submission process has two steps (or two endpoint calls).

1. **Preparation Step** - to prepare the content to be signed. The input is of fields that is to be controlled by the user. What is returned is the object and it's hash, where the hash is to be signed. The preparation step endpoints are as follows:
    * `/api/submission/prepare_thread`
    * `/api/submission/prepare_post`
    * `/api/submission/prepare_thread_vote`
    * `/api/submission/prepare_post_vote`
    * `/api/submission/prepare_user_vote`

2. **Finalization Step** - User signs the prepared content's hash provided by the preparation step's output. The user submits the hash and the signature and is presented with data, dependent of what is submitted. There is only one endpoint:
    * `/api/submission/finalize`

### Submit Thread Example

We will assume that a board exists of public key `032ffee44b9554cd3350ee16760688b2fb9d0faae7f3534917ff07e971eb36fd6b` (generated by seed "`a`").

We will also assume that the user submitting the data has a public/private key pair generated with seed "`user`":

| Name | Value |
| --- | --- |
| Public Key | `0254020da01e33cbaf2ff01e7cf28de4bb6cea43b357153fad3a50a0e7dd728718` |
| Private Key | `8705518acec973239f704aa1bdbf7f5300f006682d8f6b435976e49c8b62aab0` |

The first step is to submit to the thread preparation endpoint (`/api/submission/prepare_thread`):

| Key | Value | Description |
| --- | --- | --- |
| `of_board` | `032ffee44b9554cd3350ee16760688b2fb9d0faae7f3534917ff07e971eb36fd6b` | public key of board to submit thread to |
| `name` | `Test Thread` | name of the thread to submit |
| `body` | `This is a thread.` | body of the thread to submit |
| `creator` | `0254020da01e33cbaf2ff01e7cf28de4bb6cea43b357153fad3a50a0e7dd728718` | public key of the user that "creates" this thread |

What is returned, is a json object of this nature:

```json
{
    "okay": true,
    "data": {
        "hash": "aa3cae8136d9b669194687b1c1199c00c710e7a466d75d1a9a9b991b75a1eec0",
        "raw": "{\"type\":\"5,thread\",\"ts\":1512351651133463245,\"of_board\":\"032ffee44b9554cd3350ee16760688b2fb9d0faae7f3534917ff07e971eb36fd6b\",\"name\":\"Test Thread\",\"body\":\"This is a thread.\",\"creator\":\"0254020da01e33cbaf2ff01e7cf28de4bb6cea43b357153fad3a50a0e7dd728718\"}"
    }
}
```

At this stage, the front end needs to perform two actions.
1. Ensure that the `"raw"` data does generate a hash of that provided under `"hash"`.
2. Ensure that the data within `"raw"` is expected (that node didn't randomly change fields unexpectedly).

After it is confirmed that everything is okay, we can sign the hash with the creator's private key (`8705518acec973239f704aa1bdbf7f5300f006682d8f6b435976e49c8b62aab0`) to obtain:

```json
{
    "input": {
        "hash": "aa3cae8136d9b669194687b1c1199c00c710e7a466d75d1a9a9b991b75a1eec0",
        "secret_key": "8705518acec973239f704aa1bdbf7f5300f006682d8f6b435976e49c8b62aab0"
    },
    "sig": "3de2e798550e88d34b99b77c186441c9a9f9933ba27b5393272e2ad434a1b4e303fd419fa9b50237bfd11fda24d2c7d680b0004d8c9640f9ce3d3ff0dbd1d68200"
}
```

After obtaining the signature, we can finalize the submission via the `/api/submission/finalize` endpoint:

| Key | Value | Description |
| --- | --- | --- |
| `hash` | `aa3cae8136d9b669194687b1c1199c00c710e7a466d75d1a9a9b991b75a1eec0` | hash of content that needs submission finalization |
| `sig` | `3de2e798550e88d34b99b77c186441c9a9f9933ba27b5393272e2ad434a1b4e303fd419fa9b50237bfd11fda24d2c7d680b0004d8c9640f9ce3d3ff0dbd1d68200` | signature of the hash, generated with the creator's private key |

What is returned here would be something of this appearance (if successful):

```json
{
    "okay": true,
    "data": {
        "board": {
            "public_key": "032ffee44b9554cd3350ee16760688b2fb9d0faae7f3534917ff07e971eb36fd6b",
            "header": {},
            "body": {
                "type": "5,board",
                "ts": 1512351592165056559,
                "name": "Board A",
                "body": "Board generated with 'a'.",
                "submission_keys": [
                    "127.0.0.1:8080,0302cc8bca0b42a4e084dca0dc2c8c774e2dac1062d182103d7623ad63165e1eeb"
                ]
            }
        },
        "threads": [
            {
                "header": {
                    "hash": "b04cb9c9e2c205a254cc502dea1f2ffc1a7d5a796609b8b023ef8413a1c6b806",
                    "sig": "714421b27eb5546e6cfbda5c6adc93944213c5997bd3cc908cf3841128e9de7664bce89311e68b84e049a535e5933b2a01db27aa1f972973a31fde0361e7e7fd00"
                },
                "body": {
                    "type": "5,thread",
                    "ts": 1512351612672281575,
                    "of_board": "032ffee44b9554cd3350ee16760688b2fb9d0faae7f3534917ff07e971eb36fd6b",
                    "name": "Test Thread 1",
                    "body": "A description of thread 1.",
                    "creator": "029350fb0bc7e42a6cdac602896385c7c0e76845818908a40847e7b0f5407d98e9"
                }
            },
            {
                "header": {
                    "hash": "654560e38500105c58da7b7c2b199dad16dde8912925a35951a0b8169f2b00eb",
                    "sig": "c853eb354bce3ae2f0866bd7a6932fb563c6a8f29131d7618669c1358db40a1632f1090e0e9a2d06ec35701074b6344ba8445b0331c619c7c20a41c0fe7f13e901"
                },
                "body": {
                    "type": "5,thread",
                    "ts": 1512351618169281099,
                    "of_board": "032ffee44b9554cd3350ee16760688b2fb9d0faae7f3534917ff07e971eb36fd6b",
                    "name": "Test Thread 2",
                    "body": "A description of thread 2.",
                    "creator": "029350fb0bc7e42a6cdac602896385c7c0e76845818908a40847e7b0f5407d98e9"
                }
            },
            {
                "header": {
                    "hash": "9b8a19f51dfe0b4a7d99eb974f725b1e22b9dcdc01ce16ce3a0844b3fbbed1eb",
                    "sig": "d6347f6c3a83d19b46b7ef4bd5d3f3b47219404559b4598ae8211c6b67ee67453b84726181221233355f366a096f266fadf0314f94672b17b947fe593eeda3d901"
                },
                "body": {
                    "type": "5,thread",
                    "ts": 1512351624308233031,
                    "of_board": "032ffee44b9554cd3350ee16760688b2fb9d0faae7f3534917ff07e971eb36fd6b",
                    "name": "Test Thread 3",
                    "body": "A description of thread 3.",
                    "creator": "029350fb0bc7e42a6cdac602896385c7c0e76845818908a40847e7b0f5407d98e9"
                }
            },
            {
                "header": {
                    "hash": "aa3cae8136d9b669194687b1c1199c00c710e7a466d75d1a9a9b991b75a1eec0",
                    "sig": "3de2e798550e88d34b99b77c186441c9a9f9933ba27b5393272e2ad434a1b4e303fd419fa9b50237bfd11fda24d2c7d680b0004d8c9640f9ce3d3ff0dbd1d68200"
                },
                "body": {
                    "type": "5,thread",
                    "ts": 1512351651133463245,
                    "of_board": "032ffee44b9554cd3350ee16760688b2fb9d0faae7f3534917ff07e971eb36fd6b",
                    "name": "Test Thread",
                    "body": "This is a thread.",
                    "creator": "0254020da01e33cbaf2ff01e7cf28de4bb6cea43b357153fad3a50a0e7dd728718"
                }
            }
        ]
    }
}
```